<html>
<head>
  <title>WOMP Controller</title>
  <link rel="stylesheet" href="/static/css/normalize.css" />
  <link rel="stylesheet/less" type="text/css" href="/static/css/style.less">
  <script src="/static/js/less-1.3.0.min.js" type="text/javascript"></script>
  <script src="/static/js/jquery-1.8.1.min.js" type="text/javascript"></script>
  <script src="/static/js/dashboard.js" type="text/javascript"></script>
  <script>
  $(document).ready(function(){
    % for list_data in article_lists:
    $('#${list_data['name']}-gather').live('click', function(){
      $.getJSON('start_fetch/${list_data['name']}', function(data) {
        if (data.status == 'running') {
          $('#${list_data['name']}-controls').append("<br/><a href='" + data.url + "' target='_blank'>view dashboard</a>");
          $.getJSON(data.url + '/json', function(data) {
            console.log(data)
          });
        } else {
          console.log('Current status: ' + data.status);
        }
      });
    });
    % endfor
  });
  </script>
</head>
<body>
<h1>WOMP Controller</h1>
<p>Current fetch, progress</p>
<table id="in-prog-table">
    <thead>
        <th>name</th>
        <th>articles (unresolved)</th>
        <th>actions</th>
        <th>date</th>
        <th>...</th>
    </thead>
    <tbody>
    % for list_data in article_lists:
        <tr>
            <td><a href='/list_editor/${list_data['name']}'>${list_data['name']}</a></td>
            % if list_data['unresolved']:
                <td>${list_data['total']} (${list_data['unresolved']})</td>
            % else:
                <td>${list_data['total']}</td>
            % endif
            <td>${list_data['actions']}</td>
            <td>${list_data['date']}</td>
            <td id='${list_data['name']}-controls'><a href='#' id='${list_data['name']}-gather'>Gather data</a></td>
        </tr>
    % endfor
</ul>
